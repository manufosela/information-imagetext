<link rel="import" href="../polymer/polymer-element.html">

<dom-module id="information-imagetext">
  <template>
    <style>
      :host {
        display: block;
      }
      
      :host .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      
      :host .imgcont {
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        border: 3px solid #F00;
        overflow: hidden;
      }
      
      :host img {
        border-radius: 50%;
      }

      :host .text {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      
      :host h2,
      :host h3,
      :host h4  {
        margin: .2em;
      }

      :host .btngroup {
        display: flex;
        justify-content: flex-end;
        align-items: flex-end;
        overflow: hidden;
      }

      :host canvas { /* */}
    </style>

    <div class="container">
      <div class="btngroup" style$="width:{{size}}px;">
        <button id="zoomBtn" on-click="_zoom" hidden="{{!hasZoom}}">
          <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="10px" height="10px" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve">
            <g>
              <path d="M501.255,414.849L379.817,313.63c-17.188,26.438-39.75,49-66.156,66.188l101.188,121.438
                c11.25,13.5,30.656,14.406,43.094,1.969l45.281-45.281C515.661,445.505,514.755,426.099,501.255,414.849z"/>
              <path d="M384.005,192.004c0-106.031-85.969-192-192-192c-106.031,0-192,85.969-192,192c0,106.032,85.969,192,192,192
                C298.036,384.005,384.005,298.036,384.005,192.004z M192.004,336.005c-79.406,0-144-64.594-144-144c0-79.406,64.594-144,144-144
                c79.407,0,144,64.594,144,144C336.005,271.411,271.411,336.005,192.004,336.005z"/>
            </g>
          </svg>
        </button>
      </div>
      <div class="imgcont" style$="width:{{size}}px; height:{{size}}px">
        <img src="{{picture}}" width="{{size}}" />
      </div>
      <canvas id="texto"></canvas>
    </div>
  </template>

  <script>
    class InformationImagetext extends Polymer.Element {
      static get is() { return 'information-imagetext'; }

      static get properties() {
        return {
          picture: {
            type: String,
            value: '',
          },
          _size: {
            type: Number,
            value: 200
          },
          size: {
            type: Number,
            value: this._size
          },
          factorTextWidth:{
            type: Number,
            value: 2
          },
          zoomsize: {
            type: Number,
            value: 0,
            observer:'computeZoom'
          },
          title: {
            type: String,
            value: 'FAKE TITLE'
          },
          subtitle: {
            type: String,
            value: 'Fake Subtitle'
          },
          texts:{
            type: Object,
            value: ['uno','dos']
          },
          hasZoom: {
            type: Boolean,
            value: false
          },
          fontsize: {
            type: Number,
            computed: '_calcFontSize(size)'
          }
        };
      }
      
      constructor() {
        super();
      }

      connectedCallback() {
        super.connectedCallback();
        this._size = this.size;
        if (this.querySelector('maintitle')) {
          this.title = this.querySelector('maintitle').innerHTML;
        }
        if (this.querySelector('subtitle')) {
          this.subtitle = this.querySelector('subtitle').innerHTML;
        }
        if (this.querySelector('picture')) {
          this.picture = this.querySelector('picture').getAttribute('src');
        }
        if (this.querySelector('text')) {
          this.texts = Array.prototype.map.call(this.querySelectorAll('text'), function(n){ return n.innerHTML; });
        }
        this.printText();
        this.computeZoom();
      }

      disconeectedCallback() {
        super.disconectedCallback();
      }

      computeZoom() {
        this.hasZoom = (this.zoomsize > 0 && this.zoomsize !== this.size);
      }

      printText(){
        var canvas = this.root.querySelector('#texto');
        canvas.width = this.size * this.factorTextWidth;
        canvas.height = this.size;
        var ctx = canvas.getContext('2d');

        ctx.fillStyle = "#003300";
        ctx.font = this._getFont(canvas);
        ctx.textAlign = 'center';
        var x = canvas.width / 2;
        var y = this.fontsize + 3;
        console.log(this._getFont(canvas));
        ctx.fillText(this.title, x, y);
        ctx.fillText(this.subtitle, x, y * 2);
        for(var i=0; i<this.texts.length;i++){
          ctx.fillText(this.texts[i], x, (3+i)*y);
        }        this.factorAreaWidth
      }

      _getFont(canvas) {
        var fontBase = 120;                   // selected default width for canvas
        var fontSize = 8;
        var ratio = fontSize / fontBase;   // calc ratio
        this.fontsize = canvas.width * ratio;   // get font size based on current width
        return (this.fontsize|0) + 'px sans-serif'; // set font
      }

      _zoom() {
        this.size = (this.size==this.zoomsize)?this._size:this.zoomsize;
        this.printText();
      }

      _calcFontSize(size) {
        return size/10;
      }
     
    }

    window.customElements.define(InformationImagetext.is, InformationImagetext);
  </script>
</dom-module>
