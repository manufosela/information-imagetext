<link rel="import" href="../polymer/polymer-element.html">

<dom-module id="information-imagetext">
  <template>
    <style>
      :host {
        display: block;
        --border-color-1: #F00;
        --border-color-2: #0F0;
        --border-color-3: #00F;
      }
      
      :host .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      
      :host .imgcont, :host .imgcont2, :host .imgcont3 {
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        overflow: hidden;
      }
      :host .imgcont {
        border: 3px solid var(--border-color-1);
      }
      :host .imgcont2 {
        border: 3px solid var(--border-color-2);
      }
      :host .imgcont3 {
        border: 3px solid var(--border-color-3);
      }

      :host img {
        border-radius: 50%;
        width: 100%;
        line-height: 100%;
        text-align: center;
      }

      :host .text {
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: #AAA;
        border-radius:10px;
     }
      
      :host h2,
      :host h3,
      :host h4  {
        margin: .2em;
      }

      :host .btngroup {
        display: flex;
        justify-content: flex-end;
        align-items: flex-end;
        overflow: hidden;
      }

      :host canvas { /* */}
    </style>

    <div class="container" on-click="_zoom">
      <div class="imgcont">
        <div class="imgcont2">
          <div class="imgcont3" style$="width:{{size}}px; height:{{size}}px">
            <img src="{{picture}}" width="{{size}}" alt="{{altpicture}}"/>
          </div>
        </div>
      </div>
      <div id="texto" class="text"></div>
    </div>
  </template>

  <script>
    class InformationImagetext extends Polymer.Element {
      static get is() { return 'information-imagetext'; }

      static get properties() {
        return {
          picture: {
            type: String,
            value: '',
          },
          altpicture:{
            type: String,
            value: ''
          },
          _size: {
            type: Number,
            value: 200
          },
          size: {
            type: Number,
            value: this._size
          },
          factorTextWidth:{
            type: Number,
            value: 2
          },
          zoomsize: {
            type: Number,
            value: 0,
            observer:'computeZoom'
          },
          title: {
            type: String,
            value: 'FAKE TITLE'
          },
          subtitle: {
            type: String,
            value: 'Fake Subtitle'
          },
          texts:{
            type: Object,
            value: ['uno','dos']
          },
          hasZoom: {
            type: Boolean,
            value: false
          },
          fontsize: {
            type: Number,
            computed: '_calcFontSize(size)'
          }
        };
      }
      
      constructor() {
        super();
      }

      connectedCallback() {
        super.connectedCallback();
        this._size = this.size;
        if (this.querySelector('maintitle')) {
          this.title = this.querySelector('maintitle').innerHTML;
        }
        if (this.querySelector('subtitle')) {
          this.subtitle = this.querySelector('subtitle').innerHTML;
        }
        if (this.querySelector('picture')) {
          this.picture = this.querySelector('picture').getAttribute('src');
          this.altpicture = this.querySelector('picture').innerHTML;
        }
        if (this.querySelector('text')) {
          this.texts = Array.prototype.map.call(this.querySelectorAll('text'), function(n){ return n.innerHTML; });
        }
        this.printText();
        this.computeZoom();
      }

      disconeectedCallback() {
        super.disconectedCallback();
      }

      computeZoom() {
        this.hasZoom = (this.zoomsize > 0 && this.zoomsize !== this.size);
      }

      printText(){
        var txtCont = this.root.querySelector('#texto');
        var texto = '<h1>' + this.title + '</h1>';
        texto += '<h2>' + this.subtitle + '</h2>';
        for(var i=0; i<this.texts.length;i++) {
          texto += '<h3>' + this.texts[i] + '</h3>';
        }
        txtCont.innerHTML = texto;
      }

      _zoom() {
        this.size = (this.size===this._size*this.zoomsize)?this._size:this._size*this.zoomsize;
        this.printText();
        this.root.querySelector('#texto').style.display = (this.size===this._size*this.zoomsize)?'flex':'none';
      }

      _calcFontSize(size) {
        return size/10;
      }
     
    }

    window.customElements.define(InformationImagetext.is, InformationImagetext);
  </script>
</dom-module>
